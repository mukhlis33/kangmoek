<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>3D Viewer Lokal</title>
<style>
body { margin:0; font-family:sans-serif; display:flex; flex-direction:column; height:100vh;}
#controls { padding:10px; background:#0f172a; color:#fff;}
#canvas-wrap { flex:1; position:relative; background:#111827;}
canvas { width:100%; height:100%; display:block;}
</style>
</head>
<body>

<div id="controls">
  <input type="file" id="fileObj" accept=".obj">
  <span>Ambil file OBJ dari PC</span>
</div>
<div id="canvas-wrap"></div>

<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.156.0/build/three.module.js';
import { OrbitControls } from 'https://cdn.jsdelivr.net/npm/three@0.156.0/examples/jsm/controls/OrbitControls.js';
import { OBJLoader } from 'https://cdn.jsdelivr.net/npm/three@0.156.0/examples/jsm/loaders/OBJLoader.js';

const wrap = document.getElementById('canvas-wrap');
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x222222);

const camera = new THREE.PerspectiveCamera(45, wrap.clientWidth / wrap.clientHeight, 0.1, 1000);
camera.position.set(0,1,3);

const renderer = new THREE.WebGLRenderer({ antialias:true });
renderer.setSize(wrap.clientWidth, wrap.clientHeight);
wrap.appendChild(renderer.domElement);

const controls = new OrbitControls(camera, renderer.domElement);
controls.enableDamping = true;

scene.add(new THREE.AmbientLight(0xffffff,0.8));
const dirLight = new THREE.DirectionalLight(0xffffff,0.5);
dirLight.position.set(5,10,5);
scene.add(dirLight);

let loadedModel = null;

// Load OBJ dari file lokal
document.getElementById('fileObj').addEventListener('change', (event)=>{
  const file = event.target.files[0];
  if(!file) return;

  const reader = new FileReader();
  reader.onload = function(e){
    const contents = e.target.result;
    const loader = new OBJLoader();
    if(loadedModel) scene.remove(loadedModel);
    loadedModel = loader.parse(contents);
    loadedModel.scale.set(1,1,1);
    scene.add(loadedModel);

    // Fit kamera
    const box = new THREE.Box3().setFromObject(loadedModel);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x,size.y,size.z);
    camera.position.set(center.x + maxDim*1.5, center.y + maxDim*1.5, center.z + maxDim*1.5);
    controls.target.copy(center);
    controls.update();
  }
  reader.readAsText(file);
});

// Resize
window.addEventListener('resize', ()=>{
  camera.aspect = wrap.clientWidth / wrap.clientHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(wrap.clientWidth, wrap.clientHeight);
});

// Render loop
function animate(){
  requestAnimationFrame(animate);
  controls.update();
  renderer.render(scene,camera);
}
animate();
</script>
</body>
</html>